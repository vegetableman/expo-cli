{"version":3,"file":"paths.js","sourceRoot":"","sources":["../../src/utils/paths.ts"],"names":[],"mappings":"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","sourcesContent":["import { ExpoConfig, getWebOutputPath, readConfigJson, readConfigJsonAsync } from '@expo/config';\nimport findWorkspaceRoot from 'find-yarn-workspace-root';\nimport fs from 'fs';\nimport path from 'path';\nimport url from 'url';\n\nimport { Environment, FilePaths } from '../types';\nimport getMode from './getMode';\n\nconst possibleMainFiles = [\n  'index.web.ts',\n  'index.ts',\n  'index.web.tsx',\n  'index.tsx',\n  'src/index.web.ts',\n  'src/index.ts',\n  'src/index.web.tsx',\n  'src/index.tsx',\n  'index.web.js',\n  'index.js',\n  'index.web.jsx',\n  'index.jsx',\n  'src/index.web.js',\n  'src/index.js',\n  'src/index.web.jsx',\n  'src/index.jsx',\n  'node_modules/expo/AppEntry.js',\n];\n\nfunction ensureSlash(inputPath: string, needsSlash: boolean): string {\n  const hasSlash = inputPath.endsWith('/');\n  if (hasSlash && !needsSlash) {\n    return inputPath.substr(0, inputPath.length - 1);\n  } else if (!hasSlash && needsSlash) {\n    return `${inputPath}/`;\n  } else {\n    return inputPath;\n  }\n}\n\nexport function getAbsolutePathWithProjectRoot(\n  projectRoot: string,\n  ...pathComponents: string[]\n): string {\n  // Simple check if we are dealing with an URL\n  if (pathComponents && pathComponents.length === 1 && pathComponents[0].startsWith('http')) {\n    return pathComponents[0];\n  }\n\n  return path.resolve(projectRoot, ...pathComponents);\n}\n\nexport function getPossibleProjectRoot(): string {\n  return fs.realpathSync(process.cwd());\n}\n\nexport function getModulesPath(projectRoot: string): string {\n  const workspaceRoot = findWorkspaceRoot(path.resolve(projectRoot)); // Absolute path or null\n  if (workspaceRoot) {\n    return path.resolve(workspaceRoot, 'node_modules');\n  }\n\n  return path.resolve(projectRoot, 'node_modules');\n}\n\nfunction parsePaths(projectRoot: string, nativeAppManifest?: ExpoConfig): FilePaths {\n  const inputProjectRoot = projectRoot || getPossibleProjectRoot();\n\n  function absolute(...pathComponents: string[]): string {\n    return getAbsolutePathWithProjectRoot(inputProjectRoot, ...pathComponents);\n  }\n\n  const packageJsonPath = absolute('package.json');\n  const modulesPath = getModulesPath(inputProjectRoot);\n  const productionPath = absolute(getWebOutputPath(nativeAppManifest));\n\n  function templatePath(filename: string = ''): string {\n    const overridePath = absolute('web', filename);\n    if (fs.existsSync(overridePath)) {\n      return overridePath;\n    }\n    return path.join(__dirname, '../../web-default', filename);\n  }\n\n  function getProductionPath(...props: string[]): string {\n    return path.resolve(productionPath, ...props);\n  }\n\n  function getIncludeModule(...props: string[]): string {\n    return path.resolve(modulesPath, ...props);\n  }\n\n  return {\n    absolute,\n    includeModule: getIncludeModule,\n    packageJson: packageJsonPath,\n    root: path.resolve(inputProjectRoot),\n    appMain: getEntryPoint(inputProjectRoot),\n    modules: modulesPath,\n    servedPath: getServedPath(inputProjectRoot),\n    template: {\n      get: templatePath,\n      folder: templatePath(),\n      indexHtml: templatePath('index.html'),\n      manifest: templatePath('manifest.json'),\n      serveJson: templatePath('serve.json'),\n      favicon: templatePath('favicon.ico'),\n      serviceWorker: templatePath('expo-service-worker.js'),\n    },\n    production: {\n      get: getProductionPath,\n      folder: getProductionPath(),\n      indexHtml: getProductionPath('index.html'),\n      manifest: getProductionPath('manifest.json'),\n      serveJson: getProductionPath('serve.json'),\n      favicon: getProductionPath('favicon.ico'),\n      serviceWorker: getProductionPath('expo-service-worker.js'),\n    },\n  };\n}\n\nexport function getEntryPoint(projectRoot: string): string | null {\n  const { exp, pkg } = readConfigJson(projectRoot, true, true);\n\n  /**\n   *  The main file is resolved like so:\n   * * `app.json` -> `expo.entryPoint`\n   * * `package.json` -> `\"main\"`\n   * * `possibleMainFiles`\n   */\n  if (exp && exp.entryPoint && typeof exp.entryPoint === 'string') {\n    return getAbsolutePathWithProjectRoot(projectRoot, exp.entryPoint);\n  } else if (pkg) {\n    const { main } = pkg;\n    if (main && typeof main === 'string') {\n      return getAbsolutePathWithProjectRoot(projectRoot, main);\n    }\n    // Adds support for create-react-app (src/index.js) and react-native-cli (index.js) which don't define a main.\n    for (const fileName of possibleMainFiles) {\n      const filePath = getAbsolutePathWithProjectRoot(projectRoot, fileName);\n      if (fs.existsSync(filePath)) {\n        return filePath;\n      }\n    }\n  }\n  return null;\n}\n\nexport function getPaths(projectRoot: string): FilePaths {\n  const { exp } = readConfigJson(projectRoot, true, true);\n  return parsePaths(projectRoot, exp);\n}\n\nexport async function getPathsAsync(projectRoot: string): Promise<FilePaths> {\n  let exp;\n  try {\n    exp = (await readConfigJsonAsync(projectRoot, true, true)).exp;\n  } catch (error) {}\n  return parsePaths(projectRoot, exp);\n}\n\nexport function getServedPath(projectRoot: string): string {\n  const { pkg } = readConfigJson(projectRoot, true, true);\n  const envPublicUrl = process.env.WEB_PUBLIC_URL;\n\n  // We use `WEB_PUBLIC_URL` environment variable or \"homepage\" field to infer\n  // \"public path\" at which the app is served.\n  // Webpack needs to know it to put the right <script> hrefs into HTML even in\n  // single-page apps that may serve index.html for nested URLs like /todos/42.\n  // We can't use a relative path in HTML because we don't want to load something\n  // like /todos/42/static/js/bundle.7289d.js. We have to know the root.\n  const publicUrl = envPublicUrl || pkg.homepage;\n  const servedUrl = envPublicUrl || (publicUrl ? url.parse(publicUrl).pathname : '/');\n  return ensureSlash(servedUrl!, true);\n}\n\nexport function getPublicPaths({\n  projectRoot,\n  ...env\n}: Environment): {\n  /**\n   * Webpack uses `publicPath` to determine where the app is being served from.\n   * It requires a trailing slash, or the file assets will get an incorrect path.\n   * In development, we always serve from the root. This makes config easier.\n   */\n  publicPath: string;\n\n  /**\n   * `publicUrl` is just like `publicPath`, but we will provide it to our app\n   * as %WEB_PUBLIC_URL% in `index.html` and `process.env.WEB_PUBLIC_URL` in JavaScript.\n   * Omit trailing slash as %WEB_PUBLIC_URL%/xyz looks better than %WEB_PUBLIC_URL%xyz.\n   */\n  publicUrl: string;\n} {\n  if (getMode(env) === 'production') {\n    const publicPath = getServedPath(projectRoot);\n    return {\n      publicPath,\n      publicUrl: publicPath.slice(0, -1),\n    };\n  }\n\n  return { publicUrl: '', publicPath: '/' };\n}\n\nexport function getProductionPath(projectRoot: string): string {\n  const { exp } = readConfigJson(projectRoot, true, true);\n  return getAbsolutePathWithProjectRoot(projectRoot, getWebOutputPath(exp));\n}\n"]}